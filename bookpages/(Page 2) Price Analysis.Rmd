---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.15.2
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

# Page 2 Price Analysis


## Introduction

This page will look to analyse trends in the pricing of airbnb data. This will focus on the listings that have an average maximum booking of over 90 days so as to be able to to compare listings that are used on Airbnb as longterm rental to the traditional housing market.

```{python}
import numpy as np
import pandas as pd
import scipy.stats as sps
import matplotlib.pyplot as plt
from projtools import data_tools as dt
```

```{python}
data = dt.data_setup()
property_data = dt.group_data(data,'property')
property_data_over_90 = property_data[(property_data.maximum_nights_avg_bookings>90) & (property_data.maximum_nights_avg_bookings<1500)].copy()
property_data_over_90
```
## More Bedrooms - Higher Price?
**Statement :** According to {cite}`Tony Mariotti`, there is a strong positive correlation between bedrooms on airbnb and price.
**Question :** Can we replicate this finding?


```{python}
#Method
mean_price_per_bedroom = property_data_over_90.groupby(['bedrooms'])[['price_per_night_£']].mean()
#Graph
mean_price_per_bedroom.plot()
#Result
print(mean_price_per_bedroom)
```

(insert analysis of graph above and of next steps (seeing sample size of each grouping) below)

```{python}
bedroom_counts = property_data_over_90['bedrooms'].value_counts()
bedroom_counts
```

more stuff about sample size and what constitutes a good sample - here we went for anything over 1000, as the rule is 10% of your sample size, if it does not exceed 1000 - ours did, so we went for 1000. and how graph below which only looks at bedrooms with at most 4

```{python}
mean_price_per_bedroom[:4].plot()
```

Conclusion - this looks pretty similar to the graph in the article! Let's do a linear regression on it:

```{python}
x = np.array([0, 1, 2, 3, 4])
y = np.array(mean_price_per_bedroom['price_per_night_£'][:4])
res = sps.linregress(x, y)
res
```

The interesting number here `rvalue = 0.93` as that implies a very positive correlation ... (write more here)

```{python}
plt.scatter(x, y)
plt.plot(x, res.intercept + res.slope*x, 'r', label='fitted line')
plt.show
```

# Price and Room Type

...(write stuff here)
Some of those one-bedrooms above are because the booker only has access to one room rather than the whole apartment. Could this be part of the reason why one-bedroom appartments have the lowest price on average, as people feel uncomfortable living with strangers?

```{python}
mean_price_per_room_type = property_data_over_90.groupby(['room_type'])[['price_per_night_£']].mean()
mean_price_per_room_type
```

Seems like a pretty sharp difference between some categories! Let's make sure we're not dealing with small sample sizes again though:

```{python}
room_type_counts = property_data_over_90['room_type'].value_counts()
room_type_counts
```

Neither Shared or Hotel rooms meet our standard of minimum 1000 values for a good sample size. So we'll only focus on Entire home/apt and Private rooms, and see whether there is a higher amount of 1 bedroom airbnbs in the latter, that could be influencing our above findings.

```{python}
bedrooms_per_room_type = property_data_over_90[property_data_over_90.room_type.isin(['Entire home/apt', 'Private room'])].groupby \
                    (['room_type'])[['bedrooms']]
bedrooms_per_room_type.value_counts()
```

While Private rooms overwhelmingly have only one bedroom, the Entire home/apt category also has that as its highest category. However we know from the value_counts above that there are 27479 Private rooms listed compared to 41217 Entire home/apt, so it could still have an influence on the price.

This is however where it gets tricky. 1 bedroom airbnbs prices lower because a sizeable chunk of them are Private rooms, or are Private rooms have a lower mean price because they mostly have 1 bedroom? This is where future studies utilising more qualitative methods such as surveys or focus groups may come in useful, asking both bookers and hosts why they price certain room and bedroom amounts in certain ways.


# Comparison with Private Rentals


**Statement:** According to [The Office for National Statistics](https://www.ons.gov.uk/economy/inflationandpriceindices/adhocs/1261privaterentalmarketinlondonapril2022tomarch2023), based on the Valuation Office Agency's data, in March 2023 the prices for number of bedrooms looked like this: (the 'Room' and 'One Bedroom' types have been combined, just as the 'Private room' and 'Entire home/apt' in the Airbnb data).
**Question:** How similar is the data from Private Rentals to that of long term Airbnbs?

```{python}
private_rentals = pd.DataFrame({'bedrooms': ['0', '1', '2', '3', '4+'],
                    'mean_price_per_month': [1126, 1052, 1727, 2122, 3068]})
private_rentals['mean_price_per_night'] = private_rentals['mean_price_per_month']/30
print(private_rentals)
plt.plot(private_rentals['bedrooms'], private_rentals['mean_price_per_night'])
```

```{python}
x_private = np.array([0, 1, 2, 3, 4])
y_private = np.array(private_rentals['mean_price_per_night'][:5])
res_private = sps.linregress(x_private, y_private)
res_private
```

```{python}
plt.scatter(x_private, y_private)
plt.plot(x_private, res_private.intercept + res_private.slope*x_private, 'r', label='fitted line')
plt.show
```

This is very similar to our findings (include stuff about private room vs whole apartment split, and how combining that data might have influenced the results)


# The Must Haves

According to [Airbnb themselves](https://www.airbnb.com/resources/hosting-homes/a/the-amenities-guests-want-25) there are certain amenities that people really want to have in their airbnb. But does the price reflect that? Note that we will need to .dropna here for the .str.contains method to work, which may influence the end result.

The first most wanted amenity is a pool. This may be a stretch in London, so we'll combine that with number 5 on the list, a hot tub:

```{python}
property_data_dropna = property_data_over_90.dropna()
pool_tub_properties = property_data_dropna[property_data_dropna['amenities'].str.contains('hot tub|Hot tub|pool|Pool')]
len(pool_tub_properties)
```

This is well over our chosen minimum sample size. Let's look at the price per night for those that have and don't have a pool, while also controlling for bedrooms:

```{python}
property_data_dropna['Has Pool'] = property_data_dropna['amenities'].str.contains('hot tub|Hot tub|pool|Pool')
has_pool_grouped = property_data_dropna[property_data_dropna.bedrooms<5].groupby(['Has Pool', 'bedrooms'])[['price_per_night_£']].mean()
has_pool_grouped
```

Simply looking at the data we can see that there isn't much of a difference in price, and in fact, Airbnbs without a pool or a hot tub have a slightly higher average price per night than ones that do.
